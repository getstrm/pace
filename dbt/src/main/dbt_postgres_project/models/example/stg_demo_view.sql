with "user_groups" as (select "rolname" from "pg_roles" where ("rolcanlogin" = false and pg_has_role(session_user, oid, 'member'))) select "transactionid", case when (('fraud_and_risk' IN ( SELECT rolname FROM user_groups )) or ('administrator' IN ( SELECT rolname FROM user_groups ))) then "userid" else 42 end "userid", case when ('administrator' IN ( SELECT rolname FROM user_groups )) then "email" else 'banaan@banaan.com' end "email", "age", "transactionamount", "brand" from {{ ref('stg_demo') }} where case when (('administrator' IN ( SELECT rolname FROM user_groups )) or ('fraud_and_risk' IN ( SELECT rolname FROM user_groups ))) then true else age > 8 end